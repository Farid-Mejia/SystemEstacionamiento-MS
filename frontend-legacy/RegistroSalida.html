<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Registro de Salida</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
	crossorigin="anonymous">
</head>

<style>
body {
	font-family: Arial, sans-serif;
	margin: 0;
	padding: 0;
	background: linear-gradient(#EBB180, #A77F5E);
	min-height: 100vh;
}

.container {
	background: linear-gradient(#EBB180, #A77F5E);
	min-height: 100vh;
	padding: 20px;
}

.header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 10px 20px;
	background-color: #f8f9fa;
	border-bottom: 1px solid #dee2e6;
	border-radius: 8px;
	margin-bottom: 20px;
}

.header h1 {
	margin: 0;
	color: #333;
}

.header button {
	background-color: #dc3545;
	color: white;
	border: none;
	padding: 10px 20px;
	cursor: pointer;
	border-radius: 5px;
	transition: background-color 0.3s;
}

.header button:hover {
	background-color: #c82333;
}

.custom-navbar {
	background: linear-gradient(to right, #FBF4B9, #D4CE9D);
	border-radius: 8px;
	box-shadow: 0 0 25px #D4CE9D;
	margin-bottom: 20px;
}

.navbar-brand {
	padding-top: 0%;
	padding-left: 0%;
	font-weight: bold;
}

.form-container {
	background: white;
	border-radius: 10px;
	padding: 30px;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	margin: 20px auto;
	max-width: 600px;
}

.form-group {
	margin-bottom: 20px;
}

.form-control {
	border-radius: 5px;
	border: 1px solid #ddd;
	padding: 10px;
	font-size: 16px;
}

.form-control:focus {
	border-color: #007bff;
	box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.btn {
	padding: 12px 30px;
	border-radius: 5px;
	font-size: 16px;
	font-weight: bold;
	transition: all 0.3s;
	margin: 5px;
}

.btn-success {
	background-color: #28a745;
	border-color: #28a745;
}

.btn-success:hover {
	background-color: #218838;
	border-color: #1e7e34;
}

.btn-secondary {
	background-color: #6c757d;
	border-color: #6c757d;
}

.btn-secondary:hover {
	background-color: #5a6268;
	border-color: #545b62;
}

.help-block {
	color: #dc3545;
	margin-top: 5px;
	font-size: 14px;
}

.form-group.has-error .form-control {
	border-color: #dc3545;
	box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

.alert {
	border-radius: 5px;
	padding: 15px;
	margin: 20px 0;
}

.vehicle-info {
	background-color: #f8f9fa;
	border: 1px solid #dee2e6;
	border-radius: 5px;
	padding: 15px;
	margin-bottom: 20px;
}

.vehicle-info h5 {
	margin-bottom: 10px;
	color: #495057;
}

.info-item {
	display: flex;
	justify-content: space-between;
	margin-bottom: 8px;
}

.info-label {
	font-weight: bold;
	color: #6c757d;
}

.info-value {
	color: #495057;
}

@media (max-width: 768px) {
	.header {
		flex-direction: column;
		align-items: center;
		text-align: center;
	}
	
	.header h1 {
		margin-bottom: 10px;
	}
	
	.form-container {
		margin: 10px;
		padding: 20px;
	}
	
	.btn {
		width: 100%;
		margin-bottom: 10px;
	}
}
</style>

<body>
	<div class="container">
		<div class="header">
			<h1>Registro de Salida de Vehículos</h1>
			<button onclick="goToMenu()">Volver al Menú</button>
		</div>

		<nav class="navbar custom-navbar">
			<div class="container-fluid">
				<span class="navbar-brand">DNI de Usuario de Cibertec: </span>
				<span id="dniDisplay" class="navbar-text"></span>
			</div>
		</nav>
		
		<!-- Área para mostrar mensajes -->
		<div id="mensaje-area" class="alert" style="display: none;"></div>

		<div class="form-container">
			<h3 class="text-center mb-4">Confirmar Salida del Vehículo</h3>
			
			<!-- Información del vehículo -->
			<div class="vehicle-info">
				<h5>Información del Vehículo</h5>
				<div class="info-item">
					<span class="info-label">Placa:</span>
					<span class="info-value" id="vehiclePlate">-</span>
				</div>
				<div class="info-item">
					<span class="info-label">Plaza:</span>
					<span class="info-value" id="vehicleSlot">-</span>
				</div>
				<div class="info-item">
					<span class="info-label">Hora de Ingreso:</span>
					<span class="info-value" id="entryTime">-</span>
				</div>
				<div class="info-item">
					<span class="info-label">Tiempo Transcurrido:</span>
					<span class="info-value" id="elapsedTime">-</span>
				</div>
			</div>

			<form id="salidaForm">
				<input type="hidden" id="dniHidden" name="dni" value="">
				
				<div class="form-group">
					<label for="dniConfirm">Confirmar DNI:</label>
					<input type="text" class="form-control" id="dniConfirm" name="dniConfirm" 
						   maxlength="8" placeholder="Ingrese su DNI para confirmar" required>
					<small class="help-block"></small>
				</div>
				
				<div class="form-group">
					<label for="placaConfirm">Confirmar Placa del Vehículo:</label>
					<input type="text" class="form-control" id="placaConfirm" name="placaConfirm" 
						   maxlength="7" placeholder="Ej: ABC-123" required>
					<small class="help-block"></small>
				</div>
				
				<div class="d-grid gap-2">
					<button type="submit" class="btn btn-success">Confirmar Salida</button>
					<button type="button" class="btn btn-secondary" onclick="goToMenu()">Cancelar</button>
				</div>
			</form>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.5.3/js/bootstrapValidator.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
		crossorigin="anonymous"></script>

	<script>
		$(document).ready(function() {
			// Obtener DNI de la URL si existe
			const urlParams = new URLSearchParams(window.location.search);
			const dni = urlParams.get('dni');
			if (dni) {
				document.getElementById('dniHidden').value = dni;
				document.getElementById('dniDisplay').textContent = dni;
				
				// Simular carga de información del vehículo
				loadVehicleInfo(dni);
			}
			
			// Inicializar validador de formulario
			$('#salidaForm').bootstrapValidator({
				fields: {
					dniConfirm: {
						validators: {
							notEmpty: {
								message: 'El DNI es obligatorio'
							},
							regexp: {
								regexp: /^[0-9]{8}$/,
								message: 'El DNI debe tener 8 dígitos'
							},
							callback: {
								message: 'El DNI no coincide con el registrado',
								callback: function(value, validator, $field) {
									const originalDni = document.getElementById('dniHidden').value;
									return value === originalDni;
								}
							}
						}
					},
					placaConfirm: {
						validators: {
							notEmpty: {
								message: 'La placa es obligatoria'
							},
							regexp: {
								regexp: /^[A-Z0-9]{3}-[0-9]{3}$/,
								message: 'Formato de placa inválido (Ej: ABC-123)'
							}
						}
					}
				},
				live: 'enabled',
				feedbackIcons: {
					valid: 'glyphicon glyphicon-ok',
					invalid: 'glyphicon glyphicon-remove',
					validating: 'glyphicon glyphicon-refresh'
				}
			}).on('success.form.bv', function(e) {
				e.preventDefault();
				processExit();
			}).on('error.field.bv', function(e, data) {
				// Mostrar mensajes de error personalizados
				const messages = {
					dniConfirm: {
						notEmpty: 'El DNI es obligatorio',
						regexp: 'El DNI debe tener 8 NÚMEROS',
						callback: 'El DNI no coincide con el registrado'
					},
					placaConfirm: {
						notEmpty: 'La placa es obligatoria',
						regexp: 'Formato de placa inválido (Ej: ABC-123)'
					}
				};
				
				const field = data.field;
				const errorType = data.bv.getErrors(field)[0];
				const message = messages[field] && messages[field][errorType] ? messages[field][errorType] : 'Campo inválido';
				data.element.closest('.form-group').find('.help-block').text(message).show();
			}).on('success.field.bv', function(e, data) {
				// Ocultar mensaje de error cuando el campo es válido
				data.element.closest('.form-group').find('.help-block').hide();
			});

			// Validar campos en tiempo real
			$('input[name="dniConfirm"]').on('input', function() {
				$('#salidaForm').bootstrapValidator('revalidateField', 'dniConfirm');
			});
			
			$('input[name="placaConfirm"]').on('input', function() {
				$('#salidaForm').bootstrapValidator('revalidateField', 'placaConfirm');
			});
		});
		
		// Función para cargar información del vehículo (simulada)
		function loadVehicleInfo(dni) {
			// Simular datos del vehículo
			const vehicleData = {
				plate: 'ABC-123',
				slot: '15',
				entryTime: new Date(Date.now() - 2 * 60 * 60 * 1000).toLocaleString(), // 2 horas atrás
				elapsedTime: '2 horas 15 minutos'
			};
			
			document.getElementById('vehiclePlate').textContent = vehicleData.plate;
			document.getElementById('vehicleSlot').textContent = `Plaza ${vehicleData.slot}`;
			document.getElementById('entryTime').textContent = vehicleData.entryTime;
			document.getElementById('elapsedTime').textContent = vehicleData.elapsedTime;
		}
		
		// Función para mostrar mensajes
		function showMessage(message, type = 'info') {
			const messageArea = document.getElementById('mensaje-area');
			messageArea.className = `alert alert-${type}`;
			messageArea.textContent = message;
			messageArea.style.display = 'block';
			
			// Ocultar mensaje después de 5 segundos
			setTimeout(() => {
				messageArea.style.display = 'none';
			}, 5000);
		}
		
		// Función para procesar la salida
		function processExit() {
			const dni = document.getElementById('dniConfirm').value;
			const placa = document.getElementById('placaConfirm').value;
			const slot = document.getElementById('vehicleSlot').textContent;
			
			// Simular procesamiento exitoso
			showMessage(`Salida registrada exitosamente. DNI: ${dni}, Placa: ${placa}, ${slot}`, 'success');
			
			// Limpiar formulario
			document.getElementById('salidaForm').reset();
			$('#salidaForm').bootstrapValidator('resetForm', true);
			
			// Redirigir al menú después de 3 segundos
			setTimeout(() => {
				goToMenu();
			}, 3000);
		}
		
		// Función para volver al menú
		function goToMenu() {
			const dni = document.getElementById('dniHidden').value;
			if (dni) {
				window.location.href = `MenuPrincipal.html?dni=${dni}`;
			} else {
				window.location.href = 'MenuPrincipal.html';
			}
		}
	</script>
</body>
</html>